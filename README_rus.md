# Speech2Cursor

Проект для записи голоса с микрофона и его транскрибации в текст через OpenAI API.

## Структура проекта

- `audio_handler.py` - модуль для асинхронной транскрибации голосовых сообщений
- `config.py` - конфигурация проекта (логирование, переменные окружения)
- `file_transcribe.py` - скрипт для транскрибации существующих аудио-файлов (диалог выбора файла)
- `mic_transcribe.py` - основной скрипт для записи с микрофона и транскрибации
- `mic_transcribe_hotkey.py` - скрипт с управлением горячими клавишами (нажмите Alt+S для записи)
- `requirements.txt` - зависимости проекта
- `.env` - переменные окружения (API ключи, настройки)
- `.env.example` - пример файла переменных окружения

## Системные требования

- **Python 3.13** или выше
- Активное подключение к интернету
- Микрофон для записи голоса
- **ffmpeg** для обработки аудио-файлов (для режима транскрибации файлов)

## Установка

1. Убедитесь, что у вас установлен Python 3.13 или выше. Проверить версию можно командой:
   ```bash
   python --version
   ```

2. Клонируйте репозиторий:
   ```bash
   git clone https://github.com/Evgen-rus/Speech2Cursor.git
   cd Speech2Cursor
   ```

3. Создайте виртуальное окружение:
   ```bash
   python -m venv venv
   ```

4. Активируйте окружение:
   - Windows: `venv\Scripts\activate`
   - Linux/Mac: `source venv/bin/activate`

5. Установите зависимости:
   ```bash
   pip install -r requirements.txt
   ```

6. Установите ffmpeg (требуется для обработки аудио-файлов):
   - Скачайте с официального сайта: https://ffmpeg.org/download.html
   - Выберите версию для Windows
   - Распакуйте архив (например, в `C:\ffmpeg`)
   - Добавьте путь `C:\ffmpeg\bin` в переменную окружения PATH

7. Настройте `.env` файл:
   ```bash
   cp .env.example .env
   ```
   Откройте `.env` и замените `OPENAI_API_KEY=Ваш API ключ OpenAI` на ваш реальный API ключ OpenAI.

## Использование

### Вариант 1: Режим транскрибации файлов
Запустите скрипт для транскрибации существующих аудио-файлов:
```bash
python file_transcribe.py
```

Управление выбором файла:
- Диалог выбора файла открывается автоматически
- Выберите любой аудио-файл (.wav, .mp3, .ogg и т.д.)
- Дождитесь завершения транскрибации
- Результат сохраняется в .txt файл рядом с исходным аудио-файлом
- Формат имени файла: `имя_оригинала_transcription_ГГГГ-ММ-ДД_ЧЧ-ММ-СС.txt`

### Вариант 2: Стандартный режим
Запустите скрипт:
```bash
python mic_transcribe.py
```

Управление записью:
- Нажмите Enter для начала записи
- Говорите в микрофон
- Нажмите Enter для остановки записи
- Текст автоматически копируется в буфер обмена и готов к вставке в чат с Ctrl+V

### Вариант 3: Режим горячих клавиш

#### Способ 3.1: Запуск через командную строку
Запустите скрипт с управлением горячими клавишами:
```bash
python mic_transcribe_hotkey.py
```

#### Способ 3.2: Запуск через .bat файл (Windows)
Для удобного запуска на Windows можно использовать .bat файл:

1. Создайте файл `run_speech2cursor.bat` в корне проекта со следующим содержимым:
   ```batch
   @echo off
   echo Активация виртуального окружения...
   call venv\Scripts\activate.bat

   if %errorlevel% neq 0 (
       echo Ошибка активации виртуального окружения!
       pause
       exit /b 1
   )

   echo Запуск Speech2Cursor...
   python mic_transcribe_hotkey.py

   echo.
   echo Программа завершена.
   pause
   ```

2. Дважды кликните по файлу `run_speech2cursor.bat` для запуска

#### Способ 3.3: Ярлык на рабочий стол
Создайте ярлык со следующим расположением объекта:
```
[ПУТЬ_К_ПРОЕКТУ]\venv\Scripts\python.exe [ПУТЬ_К_ПРОЕКТУ]\mic_transcribe_hotkey.py
```

Где `[ПУТЬ_К_ПРОЕКТУ]` - полный путь к папке вашего проекта Speech2Cursor.

**Пример для вашего пути:**
```
C:\My_Scripts_PYTON\Speech2Cursor\venv\Scripts\python.exe C:\My_Scripts_PYTON\Speech2Cursor\mic_transcribe_hotkey.py
```

Управление горячими клавишами:
- Нажмите Alt+S для начала записи
- Нажмите Alt+S еще раз для остановки записи и начала транскрибации
- Текст автоматически копируется в буфер обмена
- Нажмите Ctrl+C для выхода

## Устранение неисправностей (Troubleshooting)

### Проблема: "Микрофон не найден" или "Нет звука"
**Решение:**
1. Проверьте, что микрофон подключен и включен
2. В Windows: Параметры → Звук → Ввод
3. Убедитесь, что микрофон выбран как устройство по умолчанию
4. Перезагрузите компьютер

### Проблема: "Ошибка активации виртуального окружения"
**Решение:**
1. Убедитесь, что виртуальное окружение создано: `python -m venv venv`
2. В Windows используйте: `venv\Scripts\activate`
3. Проверьте, что Python установлен правильно

### Проблема: "OpenAI API ошибка" или "Неверный API ключ"
**Решение:**
1. Проверьте API ключ в файле `.env`
2. Убедитесь, что ключ активен на сайте OpenAI
3. Проверьте баланс аккаунта OpenAI
4. Убедитесь в наличии интернета

### Проблема: "Модуль не найден" при запуске
**Решение:**
1. Активируйте виртуальное окружение
2. Установите зависимости: `pip install -r requirements.txt`
3. Если проблема persists: `pip install --upgrade -r requirements.txt`

### Проблема: Горячие клавиши не работают
**Решение:**
1. Запустите программу от имени администратора
2. Проверьте, что другие программы не перехватывают Alt+S
3. Попробуйте другие комбинации клавиш в коде

### Проблема: Текст не копируется в буфер обмена
**Решение:**
1. Проверьте, что установлен `pyperclip`
2. Попробуйте запустить от имени администратора
3. На Linux/Mac может потребоваться дополнительная настройка

### Проблема: "ffmpeg not found" или ошибка конвертации аудио
**Решение:**
1. Убедитесь, что ffmpeg установлен и добавлен в PATH
2. Проверьте установку командой: `ffmpeg -version`
3. Перезапустите командную строку после добавления ffmpeg в PATH
4. Скачайте свежую версию ffmpeg с официального сайта

## Ограничения

Проект изначально создан для удобной работы в курсоре — короткие голосовые сообщения для быстрой транскрибации.

### Режим записи с микрофона
- Максимальная длина записи: ~12-13 минут (ограничение API ~25 МБ)
- Рекомендуемая длина: 1-5 минут для оптимальной скорости
- Формат записи: WAV (16 kHz, 16-bit, моно)

### Режим транскрибации файлов
- Автоматическая нарезка длинных файлов: файлы длиннее 15 минут автоматически режутся на безопасные сегменты
- Максимальная длина одного сегмента: 15 минут (безопасный лимит для OpenAI API)
- Поддерживаемые форматы: wav, mp3, m4a, ogg, flac, webm (через ffmpeg)
- Результат: все сегменты склеиваются в один .txt файл с заголовками сегментов

### Общие требования
- Требуется активное подключение к интернету для транскрибации

## Зависимости

- `openai` - API для транскрибации
- `sounddevice` - запись с микрофона
- `soundfile` - работа с аудио-файлами
- `numpy` - обработка аудио-данных
- `pyperclip` - копирование в буфер обмена
- `keyboard` - отслеживание горячих клавиш
- `python-dotenv` - загрузка переменных окружения

## Обновление проекта

### Обновление зависимостей
```bash
# Активируйте виртуальное окружение
venv\Scripts\activate

# Обновите pip
pip install --upgrade pip

# Обновите все зависимости
pip install --upgrade -r requirements.txt
```

### Получение последних изменений (если проект на GitHub)
```bash
git pull origin main
```

### Обновление Python
Если вы хотите использовать более новую версию Python:
1. Скачайте новый Python с официального сайта
2. Создайте новое виртуальное окружение
3. Установите зависимости заново

## Лицензия

Этот проект распространяется под лицензией MIT. 
